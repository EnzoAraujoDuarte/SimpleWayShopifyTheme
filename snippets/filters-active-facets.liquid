{%- assign activeFacets = 0 -%}

<div data-active-facets class="w-full flex flex-wrap gap-3 items-center">

  {% if search_page %}
    {% assign filters = search.filters %}
    {% assign route_url = routes.search_url %}
  {% else %}
    {% assign filters = collection.filters %}
    {% assign route_url = collection.url %}
  {% endif %}

  {%- liquid
  assign sort_by = results.sort_by | default: results.default_sort_by
  if results.url
    assign results_url = results.url
  else
    assign terms = results.terms | escape
    assign results_url = '?q=' | append: terms | append: '&options%5Bprefix%5D=last&sort_by=' | append: sort_by
  endif
  -%}

  {%- for filter in filters -%}

    {%- if filter.type == "price_range" -%}

      {% assign min = filter.min_value.value %}
      {% assign max = filter.max_value.value %}

      {%- if min != null or max != null -%}

        <a href="{{ filter.url_to_remove }}" class="active-filter-chip bg-gradient-to-r from-golden-100 to-golden-200 hover:from-golden-200 hover:to-golden-300 text-golden-800 px-4 py-2 rounded-full flex items-center gap-2 border border-golden-300 hover:border-golden-400 transition-all duration-300 shadow-sm hover:shadow-md transform hover:scale-105 group">
          <div class="flex flex-col">
            <div class="text-xs uppercase font-semibold opacity-75">{{ filter.label }}</div>
            <div class="text-sm font-medium">{{ min | default: 0 | money }} - {{ max | default: filter.range_max | money }}</div>
          </div>
          <div class="w-5 h-5 rounded-full bg-golden-500 hover:bg-golden-600 flex items-center justify-center text-white transition-colors duration-200 group-hover:rotate-90" aria-label="Remove">
            {% render 'icon-close' %}
          </div>
        </a>

        {%- assign activeFacets = activeFacets | plus: 1 -%}

      {%- endif -%}

    {%- else -%}

      {%- for value in filter.active_values -%}

        {% if value.count > 0 %}

          <facet-remove>

            <a href="{{ value.url_to_remove }}" class="active-filter-chip bg-gradient-to-r from-blue-50 to-blue-100 hover:from-blue-100 hover:to-blue-200 text-blue-800 px-4 py-2 rounded-full flex items-center gap-2 border border-blue-200 hover:border-blue-300 transition-all duration-300 shadow-sm hover:shadow-md transform hover:scale-105 group">
              <div class="flex flex-col">
                <div class="text-xs uppercase font-semibold opacity-75">{{ filter.label }}</div>
                <div class="text-sm font-medium">{{ value.label }}</div>
              </div>
              <div class="w-5 h-5 rounded-full bg-blue-500 hover:bg-blue-600 flex items-center justify-center text-white transition-colors duration-200 group-hover:rotate-90" aria-label="Remove">
                {% render 'icon-close' %}
              </div>
            </a>

          </facet-remove>

          {%- assign activeFacets = activeFacets | plus: 1 -%}

        {% endif %}

      {%- endfor -%}

    {%- endif -%}

  {%- endfor -%}

  {% if activeFacets > 0 %}
    <facet-remove>
      <a href="{{ results_url }}" data-filter-reset class="reset-all-btn bg-gradient-to-r from-gray-100 to-gray-200 hover:from-gray-200 hover:to-gray-300 text-gray-700 px-4 py-2 rounded-full flex items-center gap-2 border border-gray-300 hover:border-gray-400 transition-all duration-300 shadow-sm hover:shadow-md transform hover:scale-105 font-medium">
        <span class="text-sm">Reset All</span>
        <div class="w-5 h-5 rounded-full bg-gray-500 hover:bg-gray-600 flex items-center justify-center text-white transition-colors duration-200">
          <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </div>
      </a>
    </facet-remove>
  {% endif %}

  <div id="activeFacetsCount" data-count="{{ activeFacets }}"></div>

</div>

<style>
  .active-filter-chip {
    position: relative;
    overflow: hidden;
  }
  
  .active-filter-chip::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.5s;
  }
  
  .active-filter-chip:hover::before {
    left: 100%;
  }
  
  .reset-all-btn {
    position: relative;
    overflow: hidden;
  }
  
  .reset-all-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    transition: left 0.5s;
  }
  
  .reset-all-btn:hover::before {
    left: 100%;
  }
  
  /* Animação de entrada para os chips */
  .active-filter-chip,
  .reset-all-btn {
    animation: slideIn 0.3s ease-out;
  }
  
  @keyframes slideIn {
    0% {
      opacity: 0;
      transform: translateY(10px) scale(0.95);
    }
    100% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }
  
  /* Responsividade */
  @media (max-width: 768px) {
    .active-filter-chip,
    .reset-all-btn {
      font-size: 14px;
      padding: 8px 12px;
    }
    
    .active-filter-chip .text-xs {
      font-size: 10px;
    }
    
    .active-filter-chip .text-sm {
      font-size: 12px;
    }
  }
  
  @media (prefers-reduced-motion: reduce) {
    .active-filter-chip,
    .reset-all-btn {
      animation: none;
      transition: none;
    }
    
    .active-filter-chip::before,
    .reset-all-btn::before {
      transition: none;
    }
  }
</style>